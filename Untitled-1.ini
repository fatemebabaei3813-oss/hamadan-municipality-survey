.Fateme Babayi., [21.05.25 12:32]
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>سامانه نظرسنجی</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="py-5">

<div class="container">
  <h2 class="text-center mb-4">لطفاً در یکی از نظرسنجی‌های زیر شرکت کنید</h2>

  <div class="mb-3 text-end">
    کاربر: <b id="currentUser"></b> | <button id="logoutBtn" class="btn btn-sm btn-danger">خروج</button>
  </div>

  <div class="row g-4" id="surveyContainer"></div>
</div>

<script>
  // داده‌های تستی نظرسنجی (می‌تونی از localStorage یا سرور بگیری)
  const surveys = [
    { title: 'پاکیزگی معابر', description: 'عملکرد شهرداری استان همدان در پاکیزگی معابر چگونه بوده است؟' },
    { title: 'حمل و نقل عمومی', description: 'عملکرد شهرداری استان همدان در حمل و نقل عمومی چگونه بوده است؟' },
    { title: 'فضای سبز', description: 'عملکرد شهرداری استان همدان در فضای سبز چگونه بوده است؟' },
    { title: 'روشنایی معابر', description: 'عملکرد شهرداری استان همدان در روشنایی معابر چگونه بوده است؟' }
  ];

  const votesKey = "votes"; // کل آراء به صورت {surveyTitle: {عالی: n, متوسط: n, ضعیف: n}}
  const userVotesKey = "userVotes"; // برای ثبت اینکه هر کاربر کجا رای داده (ساختار: {username: [surveyTitle1, surveyTitle2,...]})

  const currentUser = localStorage.getItem('currentUser');
  if (!currentUser) {
    alert('لطفا ابتدا وارد شوید.');
    window.location.href = 'user-login.html';
  }

  document.getElementById('currentUser').textContent = currentUser;

  document.getElementById('logoutBtn').onclick = () => {
    localStorage.removeItem('currentUser');
    window.location.href = 'user-login.html';
  };

  const container = document.getElementById('surveyContainer');

  // بارگذاری آراء
  function loadVotes() {
    return JSON.parse(localStorage.getItem(votesKey)) || {};
  }
  function saveVotes(votes) {
    localStorage.setItem(votesKey, JSON.stringify(votes));
  }
  function loadUserVotes() {
    return JSON.parse(localStorage.getItem(userVotesKey)) || {};
  }
  function saveUserVotes(userVotes) {
    localStorage.setItem(userVotesKey, JSON.stringify(userVotes));
  }

  // ساخت کارت نظرسنجی
  function createSurveyCard(survey) {
    const votes = loadVotes();
    const voteCounts = votes[survey.title] || { 'عالی': 0, 'متوسط': 0, 'ضعیف': 0 };

    // چک اگر کاربر قبلا رای داده
    const userVotes = loadUserVotes();
    const userHasVoted = userVotes[currentUser]?.includes(survey.title);

    const col = document.createElement('div');
    col.className = 'col-md-3 col-sm-6';

    col.innerHTML = 
      <div class="survey-card p-3 border rounded" style="cursor: default;">
        <h5>${survey.title}</h5>
        <p>${survey.description}</p>
        <canvas id="chart-${survey.title}" style="max-height:150px;"></canvas>
        <div class="mt-2">
          ${userHasVoted ? '<p class="text-success">شما قبلاً رای داده‌اید.</p>' : 
            <button class="btn btn-success btn-sm mx-1" onclick="castVote('${survey.title}', 'عالی')">عالی</button>
            <button class="btn btn-warning btn-sm mx-1" onclick="castVote('${survey.title}', 'متوسط')">متوسط</button>
            <button class="btn btn-danger btn-sm mx-1" onclick="castVote('${survey.title}', 'ضعیف')">ضعیف</button>
          }
        </div>
      </div>
    ;
    container.appendChild(col);

    renderChart(survey.title, voteCounts);
  }

  // تابع رأی دادن
  function castVote(surveyTitle, vote) {
    let userVotes = loadUserVotes();
    if (userVotes[currentUser]?.includes(surveyTitle)) {
      alert('شما قبلاً به این نظرسنجی رای داده‌اید.');
      return;
    }

    let votes = loadVotes();
    if (!votes[surveyTitle]) votes[surveyTitle] = { 'عالی': 0, 'متوسط': 0, 'ضعیف': 0 };
    votes[surveyTitle][vote]++;
    saveVotes(votes);

.Fateme Babayi., [21.05.25 12:32]
if (!userVotes[currentUser]) userVotes[currentUser] = [];
    userVotes[currentUser].push(surveyTitle);
    saveUserVotes(userVotes);

    alert('رای شما با موفقیت ثبت شد.');
    refreshSurveys();
  }

  // رسم نمودار
  function renderChart(surveyTitle, data) {
    const ctx = document.getElementById(chart-${surveyTitle}).getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['عالی', 'متوسط', 'ضعیف'],
        datasets: [{
          data: [data['عالی'], data['متوسط'], data['ضعیف']],
          backgroundColor: ['#4caf50', '#ffc107', '#f44336'],
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } }
      }
    });
  }

  // پاکسازی و بارگذاری مجدد کارت‌ها
  function refreshSurveys() {
    container.innerHTML = '';
    surveys.forEach(createSurveyCard);
  }

  refreshSurveys();

</script>

</body>
</html>